---
title: "CDC Data analysis"
---

I downloaded data from the BEAM dashboard (found here: https://data.cdc.gov/Foodborne-Waterborne-and-Related-Diseases/BEAM-Dashboard-Serotypes-of-concern-Illnesses-and-/fvm6-ic5r/about_data)
I specifically filtered for data from year_first_ill is > 2020 so there should be about 5 years of data.

Now to lead in my packages:
```{r}
library(here) #to set paths
library(dplyr) #for data processing/cleaning
library(tidyr) #for data processing/cleaning
library(skimr) #for nice visualization of data 
library(eeptools) #I need to remove commas and this is the easiest way I found
library(ggplot2) #plots!
```

Now to load in my data:
```{r}
data_location <- here::here("cdcdata-exercise", "BEAM_Dashboard_Data.csv")
BEAM <- read.csv(data_location)
```

Now to get a glimpse of my data:
```{r}
summary(BEAM)
glimpse(BEAM)
skim(BEAM)
```
There are 339 observations of 10 variables. Some of these variables probably shouldn't be characters like Year. Some of these categories also feel unnessesary, like table_id which looks like it just contains info from several other columns. Also Pathogen should be _Salmonella_ for all of this data, so it is unhelpful (and we can see there is only one observation). It does look like there's no missing data though. There are 36 unique serovars which is cool!

Lets remove the useless variables
```{r}
d1 <- data.frame(BEAM$Food_category, BEAM$Year_first_ill, BEAM$Serotype, BEAM$No_of_illnesses, BEAM$No_of_outbreaks, BEAM$Year, BEAM$Year_range, BEAM$Running_total_by_year_range )
skim(d1)
```
#Note to future self: this renames the variables to BEAM.variable

Lets turn the year into a numeric variable
```{r}
d1$BEAM.Year <- decomma(d1$BEAM.Year)
glimpse(d1$BEAM.Year)
d1$BEAM.Year_first_ill <- decomma(d1$BEAM.Year_first_ill)
glimpse(d1$BEAM.Year_first_ill)
```

I want to make sure that these categorical variables are actually categories
```{r}
d1$BEAM.Serotype <- as.factor(d1$BEAM.Serotype)
d1$BEAM.Food_category <- as.factor(d1$BEAM.Food_category)
skim(d1)
summary(d1)
```
I can now see that the most common serovars are monophasic Typhimurium (I 4,5,12,:i:-), Braenderup, Muenchen, Enteritidis, Typhimurium, and Newport.

This just leaves year range as something that should maybe be fixed. This one is tricky though, because each outbreak is going to have a separate year range. Also given how I filtered the data by year first ill this column may not be helpful.

I want to know what commodities are associated with my top 6 serovars
```{r}
d2 <- subset(d1, (BEAM.Serotype == "Typhimurium" | BEAM.Serotype == "Braenderup" | BEAM.Serotype == "Muenchen" | BEAM.Serotype == "Newport" | BEAM.Serotype == "I 4,[5],12:i:-"))
summary(d2)

p1 <- d2 %>% ggplot(aes(x=BEAM.Food_category)) + geom_bar()
plot(p1)

p2 <- d2 %>% ggplot(aes(x=BEAM.Serotype)) + geom_bar()
plot(p2)

p3 <- d2 %>% ggplot(aes(fill=BEAM.Serotype, x=BEAM.Food_category)) + geom_bar()
plot(p3)
```
This gets counts of these top commodities and the top serovars, then proportion of each commodity that responds to each serovar!

# This section is contributed by Rebecca Basta
AI prompt used: "Write R code to generate synthetic outbreak data similar in structure to CDC BEAM Salmonella dataset with 339 rows, 10 columns, and categorical + count variables."

```{r}
set.seed(123)  # reproducibility
```

```{r}
# Number of observations similar to original
n <- 339

# Create synthetic dataset
synthetic_data <- data.frame(
  Food_category = sample(
    c("Chicken", "Beef", "Pork", "Eggs", "Vegetables", 
      "Fruit", "Seafood", "Dairy", "Turkey"),
    n, replace = TRUE
  ),
  
  Serotype = sample(
    paste("Serotype", 1:36),
    n, replace = TRUE
  ),
  
  Year_first_ill = sample(2021:2024, n, replace = TRUE),
  
  Year = sample(2021:2024, n, replace = TRUE),
  
  No_of_illnesses = rpois(n, lambda = 25),
  
  No_of_outbreaks = rpois(n, lambda = 3)
)

# Running total by year range
synthetic_data <- synthetic_data %>%
  arrange(Year) %>%
  mutate(Running_total_by_year_range = cumsum(No_of_illnesses))

glimpse(synthetic_data)
summary(synthetic_data)
```

```{r}
#renaming the serotypes from my synthetic data, so the plots can have the correct axis names
#Before I did this, the plots were blank. I asked AI why they were blank and it was because the variable names didn't match, which is why I recoded them.
synthetic_data <- synthetic_data %>%
  mutate(
    Serotype = recode(
      Serotype,
      "Serotype 1" = "Typhimurium",
      "Serotype 2" = "Braenderup",
      "Serotype 3" = "Muenchen",
      "Serotype 4" = "Newport",
      "Serotype 5" = "I 4,[5],12:i:-"
    )
  )
```

```{r}
#Created a subset for the plots to have the same plots
plot_subset <- subset(
  synthetic_data,
  Food_category %in% c("Beef", "Chicken", "Pork", "Turkey") &
  Serotype %in% c(
    "Typhimurium",
    "Braenderup",
    "Muenchen",
    "Newport",
    "I 4,[5],12:i:-"
  )
)
```

Plots
```{r}
p1 <- ggplot(plot_subset, aes(x = Food_category)) +
  geom_bar() +
  labs(x = "Food_category (synthetic data)", y = "count")
p1

p2 <- ggplot(plot_subset, aes(x = Serotype)) +
  geom_bar() +
  labs(x = "Serotype (synthetic data)", y = "count")
p2

p3 <- ggplot(plot_subset, aes(x = Food_category, fill = Serotype)) +
  geom_bar() +
  labs(x = "Food_category", y = "count", fill = "Serotype")
p3
```
The synthetic data is a little different then the orginal data because the food catergory and serotype are random in the synthetic data. Other then that, the synthetic data and orginal data are the same. They both include 339 rows, 10 columns, and the same variables.
